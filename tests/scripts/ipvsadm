#!/usr/bin/env python

import sys
import getopt
import os

header=['IP Virtual Server version 1.2.1 (size=4096)',
        'Prot LocalAddress:Port Scheduler Flags', 
        '  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn']

numeric_tcp=['TCP  10.10.1.1:80                 rr',
             '  -> 10.10.10.2:80                Masq    1      0          0',
             '  -> 10.10.10.3:80                Masq    1      0          0']

numeric_udp=['UDP  10.10.1.1:53                 rr',
             '  -> 10.10.10.10:53               Masq    1      0          0',
             '  -> 10.10.10.11:53               Masq    1      0          0']

def main():
  try:
    opts, args = getopt.getopt(sys.argv[1:], "Lnt:u:f:",
                               ["list"])
  except getopt.error, msg:
    print msg
    sys.exit(1)
  
  listing = True
  tcp = False
  udp = False
  fwm = False
  numeric = False

  for opt, arg in opts:
    if opt in ("-L", "--list"):
      listing = True
    elif opt == "-t":
      if arg == "10.10.1.1:80":
        tcp = True
    elif opt == "-u":
      if arg == "10.10.1.1:53":
        udp = True
    elif opt == "-f":
      fwm = True
    elif opt == "-n":
      numeric = True

  path = os.path.abspath(os.path.dirname(__file__))
  maintenance = path + "/../maintenance"
  filenames = os.listdir(maintenance)

  for index, item in enumerate(numeric_tcp):
    for filename in filenames:
      if filename in item:
        del numeric_tcp[index]

  for index, item in enumerate(numeric_udp):
    for filename in filenames:
      if filename in item:
        del numeric_udp[index]

  if tcp:
    if numeric:
      full_list = numeric_tcp
  elif udp:
    if numeric:
      full_list = numeric_udp
  else:
    if numeric:
      full_list = numeric_tcp + numeric_udp

  for item in header:
    print item
  for item in full_list:
    print item

if __name__ == '__main__':
  main()
